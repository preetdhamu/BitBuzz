{%extends 'base1.html'%}
{% load static %}

{%block profile %}
<li class="user">
    <a data-toggle="modal" data-target="#exampleModalCenter3">
        <span class="image">
            <img src="{% static 'logo.jpg'%}" alt="logo">
        </span>
        <span class="text header-text">{{ profile.name }}</span>
    </a>
</li>
{%endblock%}

{% block gates %}
<li class="">
    <a href="{% url 'custom_logout' %}">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
            class="bi bi-box-arrow-left icon" viewBox="0 0 16 16">
            <path fill-rule="evenodd"
                d="M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0v2z" />
            <path fill-rule="evenodd"
                d="M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z" />
        </svg>
        <span class="text nav-text">Logout</span>
    </a>
</li>
{% endblock %}

{% block upperheader %}
<div class="content">
    <h1>{{greet}},{{profile.name}}</h1>
    <h2 id="likemsg"></h2>
    <!-- <p>Hey {{profile.name }}</p> -->
    <p>Say 'Hey Dimmy' and press 'Play'</p>
    <div class="buttons">
        <button id="play1">Play</button>
    </div>


</div>
{% endblock %}

{% block content %}
<div class="popular_song">
    <div class="h4">
        <h4>Popular Song</h4>
        <p>{{songs}}</p>
        <div class="btn_s">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                class="bi bi-arrow-left-short icon" id="pop_song_left" viewBox="0 0 16 16">
                <path fill-rule="evenodd"
                    d="M12 8a.5.5 0 0 1-.5.5H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5a.5.5 0 0 1 .5.5z" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                class="bi bi-arrow-right-short icon" id="pop_song_right" viewBox="0 0 16 16">
                <path fill-rule="evenodd"
                    d="M4 8a.5.5 0 0 1 .5-.5h5.793L8.146 5.354a.5.5 0 1 1 .708-.708l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708-.708L10.293 8.5H4.5A.5.5 0 0 1 4 8z" />
            </svg>
        </div>
    </div>
    <div class="pop_song ">
        {% for i in top_songs %}
        <li class="songItem">
            <span class="like" style="padding-left: 80px; padding-bottom: 0;">
                <form id="like_song{{i.id}}" method="post" action="/like_song/{{i.id}}" style="display: inline-block;">
                    {% csrf_token %}
                    <label for="a_like{{i.id}}" id="heart{{i.id}}" onclick="change_color(this)">


                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-heart-fill 
                        {% for song in liked_songs%}
                        {% if song == i %}
                         text-danger
                        {% endif %}
                        {% endfor  %}
                        " viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z" />
                        </svg>

                    </label>
                    <input type="text" id="songid{{i.id}}" name="songid{{i.id}}" value="{{i.id}}"
                        style="display: none;">
                    <input type="submit" id="a_like{{i.id}}" style="display: none;">
                </form>
            </span>
            <div class="img_play">
                <img src="{% static 'logo.jpg' %}" alt="">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    class="bi bi-play-fill playListPlay icon" id="{{i.id}}" viewBox="0 0 16 16">
                    <path
                        d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z" />
                </svg>
            </div>
            <h5>ON my Way <br>
                <div class="subtitle">Alan Walker</div>
            </h5>
        </li>
        {% endfor %}

    </div>
</div>
<div class="popular_artists">
    <div class="h4">
        <h4>Popular Artists</h4>
        <div class="btn_s">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                class="bi bi-arrow-left-short icon" id="pop_art_left" viewBox="0 0 16 16">
                <path fill-rule="evenodd"
                    d="M12 8a.5.5 0 0 1-.5.5H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5a.5.5 0 0 1 .5.5z" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                class="bi bi-arrow-right-short icon" id="pop_art_right" viewBox="0 0 16 16">
                <path fill-rule="evenodd"
                    d="M4 8a.5.5 0 0 1 .5-.5h5.793L8.146 5.354a.5.5 0 1 1 .708-.708l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708-.708L10.293 8.5H4.5A.5.5 0 0 1 4 8z" />
            </svg>
        </div>
    </div>
    <div class="item">
        {% for i in artists %}
        <li>
            <a href="">
                <img src="{{i.user_profile_image.url}}" alt="">
            </a>
        </li>
        {% endfor %}

    </div>
</div>
{% endblock %}

{% block player %}
<div class="player">
    <div class="master_player">
        <div class="wave" id="wave">
            <div class="wave1"></div>
            <div class="wave1"></div>
            <div class="wave1"></div>
        </div>
        <img src="{% static 'logo.jpg' %}" alt="" id="poster_master_play">
        <h5 id="title">No Song Selected
            <div class="subtitle">Mind Reader</div>
        </h5>
        <div class="icons">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                class="bi bi-music-note-beamed icon shuffle" viewBox="0 0 16 16">
                Next
                <path
                    d="M6 13c0 1.105-1.12 2-2.5 2S1 14.105 1 13c0-1.104 1.12-2 2.5-2s2.5.896 2.5 2zm9-2c0 1.105-1.12 2-2.5 2s-2.5-.895-2.5-2 1.12-2 2.5-2 2.5.895 2.5 2z" />
                <path fill-rule="evenodd" d="M14 11V2h1v9h-1zM6 3v10H5V3h1z" />
                <path d="M5 2.905a1 1 0 0 1 .9-.995l8-.8a1 1 0 0 1 1.1.995V3L5 4V2.905z" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                class="bi bi-skip-start-fill icon" id="back" viewBox="0 0 16 16">
                <path
                    d="M4 4a.5.5 0 0 1 1 0v3.248l6.267-3.636c.54-.313 1.232.066 1.232.696v7.384c0 .63-.692 1.01-1.232.697L5 8.753V12a.5.5 0 0 1-1 0V4z" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                class="bi bi-play-fill icon" id="masterPlay" viewBox="0 0 16 16">
                <path
                    d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                class="bi bi-skip-end-fill icon" id="next" viewBox="0 0 16 16">
                <path
                    d="M12.5 4a.5.5 0 0 0-1 0v3.248L5.233 3.612C4.693 3.3 4 3.678 4 4.308v7.384c0 .63.692 1.01 1.233.697L11.5 8.753V12a.5.5 0 0 0 1 0V4z" />
            </svg>
            <a href="" download id="download_music">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    class="bi bi-cloud-arrow-down-fill icon" viewBox="0 0 16 16">
                    <path
                        d="M8 2a5.53 5.53 0 0 0-3.594 1.342c-.766.66-1.321 1.52-1.464 2.383C1.266 6.095 0 7.555 0 9.318 0 11.366 1.708 13 3.781 13h8.906C14.502 13 16 11.57 16 9.773c0-1.636-1.242-2.969-2.834-3.194C12.923 3.999 10.69 2 8 2zm2.354 6.854-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 1 1 .708-.708L7.5 9.293V5.5a.5.5 0 0 1 1 0v3.793l1.146-1.147a.5.5 0 0 1 .708.708z" />
                </svg>
            </a>
        </div>
        <span id="currentStart">0:00</span>
        <div class="bar">
            <input type="range" id="seek" min="0" max="100">
            <div class="bar2" id="bar2"></div>
            <div class="dot"></div>
        </div>
        <span id="currentEnd">0:30</span>
        <div class="vol">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-volume-up-fill" viewBox="0 0 16 16" id="vol_icon">
                <path d="M11.536 14.01A8.473 8.473 0 0 0 14.026 8a8.473 8.473 0 0 0-2.49-6.01l-.708.707A7.476 7.476 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303l.708.707z"/>
                <path d="M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.483 5.483 0 0 1 11.025 8a5.483 5.483 0 0 1-1.61 3.89l.706.706z"/>
                <path d="M8.707 11.182A4.486 4.486 0 0 0 10.025 8a4.486 4.486 0 0 0-1.318-3.182L8 5.525A3.489 3.489 0 0 1 9.025 8 3.49 3.49 0 0 1 8 10.475l.707.707zM6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06z"/>
              </svg>
            <input type="range" name="" id="vol" min="0" max="100">
            <div class="vol_bar"></div>
            <div class="dot" id="vol_dot"></div>
        </div>
    </div>
</div>
<a href="#">
    <span class="text nav-text" data-dismiss="modal">Register</span>
</a>

<div class="modal" id="exampleModalCenter3" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Basic Information</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">


                <form method="post" action="">
                    {% csrf_token %}
                    <div class="mb-3 box">
                        {% if not profile.phone_number %}
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-envelope" viewBox="0 0 16 16">
                            <path
                                d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4Zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2Zm13 2.383-4.708 2.825L15 11.105V5.383Zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741ZM1 11.105l4.708-2.897L1 5.383v5.722Z" />
                        </svg>
                        <input type="email" class="form-control box1" id="user_email1" aria-describedby="emailHelp"
                            placeholder="What's your Email" name="user_email1" value="{{profile.email}}">
                        {% endif %}
                    </div>
                    {% if profile.phone_number %}
                    <div class="mb-3 box">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-envelope" viewBox="0 0 16 16">
                            <path
                                d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4Zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2Zm13 2.383-4.708 2.825L15 11.105V5.383Zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741ZM1 11.105l4.708-2.897L1 5.383v5.722Z" />
                        </svg>
                        <input type="email" class="form-control box1" id="user_email2" aria-describedby="emailHelp"
                            placeholder="What's your Email" name="user_email2">
                    </div>
                    <div class="mb-3 box">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-lock" viewBox="0 0 16 16">
                            <path
                                d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2zM5 8h6a1 1 0 0 1 1 1v5a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V9a1 1 0 0 1 1-1z" />
                        </svg>
                        <input type="password" class="form-control box1" id="user_password1"
                            aria-describedby="emailHelp" placeholder="Set's a Password" name="user_password1">
                    </div>
                    {% endif %}
                    <div class="mb-3 box">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-telephone" viewBox="0 0 16 16">
                            <path
                                d="M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.568 17.568 0 0 0 4.168 6.608 17.569 17.569 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.678.678 0 0 0-.58-.122l-2.19.547a1.745 1.745 0 0 1-1.657-.459L5.482 8.062a1.745 1.745 0 0 1-.46-1.657l.548-2.19a.678.678 0 0 0-.122-.58L3.654 1.328zM1.884.511a1.745 1.745 0 0 1 2.612.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z" />
                        </svg>
                        <input type="text" class="form-control box1" id="user_phone_number" aria-describedby="emailHelp"
                            placeholder="What's your phone number" name="user_phone_number"
                            value="{{profile.phone_number}}">
                    </div>
                    <div class="mb-3 box">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-person-vcard" viewBox="0 0 16 16">
                            <path
                                d="M5 8a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm4-2.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 1-.5-.5ZM9 8a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4A.5.5 0 0 1 9 8Zm1 2.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5Z" />
                            <path
                                d="M2 2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H2ZM1 4a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H8.96c.026-.163.04-.33.04-.5C9 10.567 7.21 9 5 9c-2.086 0-3.8 1.398-3.984 3.181A1.006 1.006 0 0 1 1 12V4Z" />
                        </svg>
                        <input type="text" class="form-control box1" id="user_name" required
                            aria-describedby="emailHelp" placeholder="what should we call you ?"
                            style="background:none;" name="user_name" value="{{profile.name}}">
                    </div>
                    <div class="mb-3 box">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-calendar3" viewBox="0 0 16 16">
                            <path
                                d="M14 0H2a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zM1 3.857C1 3.384 1.448 3 2 3h12c.552 0 1 .384 1 .857v10.286c0 .473-.448.857-1 .857H2c-.552 0-1-.384-1-.857V3.857z" />
                            <path
                                d="M6.5 7a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" />
                        </svg>
                        <input type="date" class="form-control box1" id="user_birthdate" name="user_birthdate" required
                            min="1900-01-01" max="2023-12-31" placeholder="what is your Birth date ?"
                            value="{{profile.dob}}">
                    </div>

                    <div class="mb-3 box">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-person-bounding-box" viewBox="0 0 16 16">
                            <path
                                d="M1.5 1a.5.5 0 0 0-.5.5v3a.5.5 0 0 1-1 0v-3A1.5 1.5 0 0 1 1.5 0h3a.5.5 0 0 1 0 1h-3zM11 .5a.5.5 0 0 1 .5-.5h3A1.5 1.5 0 0 1 16 1.5v3a.5.5 0 0 1-1 0v-3a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 1-.5-.5zM.5 11a.5.5 0 0 1 .5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 1 0 1h-3A1.5 1.5 0 0 1 0 14.5v-3a.5.5 0 0 1 .5-.5zm15 0a.5.5 0 0 1 .5.5v3a1.5 1.5 0 0 1-1.5 1.5h-3a.5.5 0 0 1 0-1h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 1 .5-.5z" />
                            <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm8-9a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" />
                        </svg>
                        <select id="gender" name="gender" class="form-control box1">
                            <option value="{{profile.gender}}" selected>Male</option>
                            <option value="F">Female</option>
                            <option value="O">Other</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-outline-dark " style="margin-left: 40px;">Save Now</button>
                </form>
            </div>
            <div class="modal-footer box" id="modalfooter">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>



{% endblock %}

{% block javascript %}
<script>

    function change_color(element) {
        console.log(element.id)
        if (element.classList.contains('text-danger')) {
            element.classList.remove('text-danger')
            // data='Removed to Liked Songs'
            // $('#likemsg').html(data);
        } else {
            element.classList.add('text-danger')
            // data1='Added to Liked Songs'
            // $('#likemsg').html(data1);
        }
    }

    $(document).ready(function () {
        $('form[id^="like_song"]').on('submit', function (event) {
            event.preventDefault();

            var form = $(this);
            var formData = form.serializeArray();

            var jsonData = {};
            $(formData).each(function (index, obj) {
                jsonData[obj.name] = obj.value;

            });

            $.ajax({
                type: form.attr('method'),
                url: form.attr('action'),
                data: JSON.stringify(jsonData),
                dataType: 'json',
                contentType: 'application/json',
                beforeSend: function (xhr) {
                    xhr.setRequestHeader('X-CSRFToken', '{{ csrf_token }}');
                },
                success: function (response) {
                    try {
                        console.log(response)
                        $('#likemsg').html(response.message);
                    } catch (error) {
                        console.error('Error occurred while handling the AJAX response:', error);
                    }
                    // alert(response)
                    // $('#likemsg').html(response);
                }
                ,
                error: function (xhr, errmsg, err) {
                    // Handle any errors that occur during the AJAX request
                    console.log(xhr.status + ": " + xhr.responseText);
                }
            });
        });
    });
    let pop_song_left = document.getElementById('pop_song_left')
    let pop_song_right = document.getElementById('pop_song_right')
    let pop_song = document.getElementsByClassName('pop_song')[0]

    pop_song_right.addEventListener('click', function (e) {
        pop_song.scrollLeft += 330;
    })
    pop_song_left.addEventListener('click', function (e) {
        pop_song.scrollLeft -= 330;
    })



    let pop_art_left = document.getElementById('pop_art_left')
    let pop_art_right = document.getElementById('pop_art_right')
    let item = document.getElementsByClassName('item')[0]

    pop_art_right.addEventListener('click', function (e) {
        item.scrollLeft += 330;
    })
    pop_art_left.addEventListener('click', function (e) {
        item.scrollLeft -= 330;
    })

    //    master player

    const songs = JSON.parse('{{ songs_json|escapejs }}');

    firstsong = "{% static '1.mp3'%}"
    const music = new Audio(firstsong);

    Array.from(document.getElementsByClassName('songItem')).forEach((e, i) => {
        e.getElementsByTagName('img')[0].src = songs[i].cover;
        e.getElementsByTagName('h5')[0].innerHTML = songs[i].songName;
    })



    let masterPlay = document.getElementById('masterPlay');
    let pathElement = masterPlay.querySelector('path');
    let wave = document.getElementById('wave');

    masterPlay.addEventListener('click', () => {
        if (music.paused || music.currentTime <= 0) {
            music.play();
            wave.classList.add('active1');
            pathElement.setAttribute('d', 'M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5zm5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5z');

        }
        else {
            music.pause();
            wave.classList.remove('active1');
            masterPlay.classList.add('bi-play-fill')
            masterPlay.classList.remove('bi-pause-fill')
            pathElement.setAttribute('d', 'm11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z')
            makeAllplays1();

        }

    })

    const makeAllBackground = () => {
        Array.from(document.getElementsByClassName('songItem')).forEach((el) => {
            el.style.background = 'rgb(105,105,105,.1)';
            el.classList.remove('ram');
        })
    }

    const makeAllplays = () => {
        Array.from(document.getElementsByClassName('playListPlay')).forEach((el) => {
            let pathElement1 = el.querySelector('path');
            pathElement.setAttribute('d', 'M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5zm5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5z');
        })
    }
    const makeAllplays1 = () => {
        Array.from(document.getElementsByClassName('playListPlay')).forEach((el) => {
            let pathElement1 = el.querySelector('path');
            pathElement1.setAttribute('d', 'm11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z')            
        })
    }

    let poster_master_play = document.getElementById('poster_master_play')
    let download_music = document.getElementById('download_music')
    let title = document.getElementById('title')
    let index = 0;
    Array.from(document.getElementsByClassName('playListPlay')).forEach((e) => {
        e.addEventListener('click', (el) => {
            index = el.target.id;
            console.log(index)
            wave.classList.add('active1');
            let songTitle = songs.filter((els) => {
                return els.id == index;
            });
            songTitle.forEach(elss => {
                let { songName } = elss;
                title.innerHTML = songName;

                let { cover } = elss;
                poster_master_play.src = cover;
                // download_music.setAttribute('download', songName)

                let { file } = elss;
                music.src = file;
                // download_music.href = music_src


            })
            music.play()

            makeAllBackground();


            Array.from(document.getElementsByClassName('songItem'))[index - 3].style.background = "rgba(105,105,105,0.5)"
            Array.from(document.getElementsByClassName('songItem'))[index - 3].classList.add('ram')
            Array.from(document.getElementsByClassName('playListPlay'))[index-3].querySelector('path').setAttribute('d', 'M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5zm5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5z');
            makeAllplays();
        })
    })

    let currentStart = document.getElementById('currentStart')
    let currentEnd = document.getElementById('currentEnd')
    let seek = document.getElementById('seek')
    let bar2 = document.getElementById('bar2')
    let dot = document.getElementsByClassName('dot')[0]


    music.addEventListener('timeupdate', () => {
        let music_curr = music.currentTime;
        let music_dur = music.duration;

        let min1 = Math.floor(music_dur / 60);
        let sec1 = Math.floor(music_dur % 60);
        if (sec1 < 10) {
            sec1 = `0${sec1}`
        }
        currentEnd.innerText = `${min1}:${sec1}`

        let min2 = Math.floor(music_curr / 60)
        let sec2 = Math.floor(music_curr % 60)
        if (sec2 < 10) {
            sec2 = `0${sec2}`
        }
        currentStart.innerText = `${min2}:${sec2}`

        let progressBar = parseFloat((music_curr / music_dur) * 100)
        seek.value = progressBar
        let seekbar = seek.value;
        bar2.style.width = `${seekbar}%`;
        dot.style.left = `${seekbar}%`;

    })


    seek.addEventListener('change', () => {
        music.currentTime = seek.value * music.duration / 100;
    })

    let vol_icon = document.getElementById('vol_icon');
    let vol = document.getElementById('vol');
    let vol_bar = document.getElementsByClassName('vol_bar')[0];
    let vol_dot = document.getElementById('vol_dot');

    vol.addEventListener('change', () => {
        if (vol.value == 0) {
            vol_icon.classList.remove('bi-volume-up-fill')
            vol_icon.classList.remove('bi-volume-down-fill')
            vol_icon.classList.add('bi-volume-off-fill')
            // vol_svg.setAttribute('d', 'M10.717 3.55A.5.5 0 0 1 11 4v8a.5.5 0 0 1-.812.39L7.825 10.5H5.5A.5.5 0 0 1 5 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06z');
        }
        if (vol.value > 0) {
            vol_icon.classList.remove('bi-volume-up-fill')
            vol_icon.classList.add('bi-volume-down-fill')
            vol_icon.classList.remove('bi-volume-off-fill')
            // vol_svg.setAttribute('d', 'M9 4a.5.5 0 0 0-.812-.39L5.825 5.5H3.5A.5.5 0 0 0 3 6v4a.5.5 0 0 0 .5.5h2.325l2.363 1.89A.5.5 0 0 0 9 12V4zm3.025 4a4.486 4.486 0 0 1-1.318 3.182L10 10.475A3.489 3.489 0 0 0 11.025 8 3.49 3.49 0 0 0 10 5.525l.707-.707A4.486 4.486 0 0 1 12.025 8z');

        }
        if (vol.value > 50) {
            vol_icon.classList.add('bi-volume-up-fill')
            vol_icon.classList.remove('bi-volume-down-fill')
            vol_icon.classList.remove('bi-volume-off-fill')
            // vol_svg.setAttribute('d', 'M11.536 14.01A8.473 8.473 0 0 0 14.026 8a8.473 8.473 0 0 0-2.49-6.01l-.708.707A7.476 7.476 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303l.708.707z');
            // vol_svg.setAttribute('d', 'M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.483 5.483 0 0 1 11.025 8a5.483 5.483 0 0 1-1.61 3.89l.706.706z');
            // vol_svg.setAttribute('d', 'M8.707 11.182A4.486 4.486 0 0 0 10.025 8a4.486 4.486 0 0 0-1.318-3.182L8 5.525A3.489 3.489 0 0 1 9.025 8 3.49 3.49 0 0 1 8 10.475l.707.707zM6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06z');

        }
        let vol_a = vol.value
        vol_bar.style.width = `${vol_a}%`
        vol_dot.style.left = `${vol_a}%`
        music.volume = vol_a / 100
    })


    let back = document.getElementById('back')
    let next = document.getElementById('next')
    back.addEventListener('click', () => {
        index -= 1

        if (index < 1) {
            index = Array.from(document.getElementsByClassName('songItem')).length;
        }

        wave.classList.add('active1');
        let songTitle = songs.filter((els) => {
            return els.id == index;
        });

        songTitle.forEach(elss => {
            let { songName } = elss;
            title.innerHTML = songName;

            let { cover } = elss;
            poster_master_play.src = cover;
            // download_music.setAttribute('download', songName)

            let { file } = elss;
            music.src = file;
            // download_music.href = music_src


        })
        music.play()

        makeAllplays1();
        makeAllBackground();
        Array.from(document.getElementsByClassName('songItem'))[index - 3].style.background = "rgba(105,105,105,0.5)"
        Array.from(document.getElementsByClassName('songItem'))[index - 3].classList.add('ram')
        Array.from(document.getElementsByClassName('playListPlay'))[index-3].querySelector('path').setAttribute('d', 'M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5zm5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5z');
        // makeAllplays1();


    })
    next.addEventListener('click', () => {
        index ++

        if (index > Array.from(document.getElementsByClassName('songItem')).length) {
            index = 1
        }
        wave.classList.add('active1');
        
        let songTitle = songs.filter((els) => {
            return els.id == index;
        });
        songTitle.forEach(elss => {
            let { songName } = elss;
            title.innerHTML = songName;

            let { cover } = elss;
            poster_master_play.src = cover;
            // download_music.setAttribute('download', songName)

            let { file } = elss;
            music.src = file;
            // download_music.href = music_src


        })
        music.play()

        makeAllplays1();
        makeAllBackground();
        Array.from(document.getElementsByClassName('songItem'))[index - 3].style.background = "rgba(105,105,105,0.5)"
        Array.from(document.getElementsByClassName('songItem'))[index - 3].classList.add('ram')
        Array.from(document.getElementsByClassName('playListPlay'))[index-3].querySelector('path').setAttribute('d', 'M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5zm5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5z');
     

    })

    music.addEventListener('ended', () => {
        index++;
        wave.classList.add('active1');
        let songTitle = songs.filter((els) => {
            return els.id == index;
        });

        songTitle.forEach(elss => {
            let { songName } = elss;
            title.innerHTML = songName;

            let { cover } = elss;
            poster_master_play.src = cover;
            // download_music.setAttribute('download', songName)

            let { file } = elss;
            music.src = file;
            // download_music.href = music_src


        })
        music.play()

        makeAllplays1();
        makeAllBackground();
        Array.from(document.getElementsByClassName('songItem'))[index - 3].style.background = "rgb(105,105,105,0.5)"
        Array.from(document.getElementsByClassName('songItem'))[index - 3].classList.add('ram')
        Array.from(document.getElementsByClassName('playListPlay'))[index-3].querySelector('path').setAttribute('d', 'M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5zm5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5z');
    })


    $(document).ready(function () {
        $('#your_bb').click(function (event) {
            event.preventDefault();  // Prevent the default anchor tag behavior
            var csrftoken = getCookie('csrftoken');
            $.ajax({
                url: 'your_bb',
                type: 'POST',
                dataType: 'json',
                beforeSend: function (xhr, settings) {
                    xhr.setRequestHeader('X-CSRFToken', csrftoken);
                },
                success: function (data) {

                    const songs1 = JSON.parse(data.songs_json);
                    console.log(songs1)
                    playSongs(songs1);
                },
                error: function (xhr, errmsg, err) {
                    console.log(xhr.status + ': ' + xhr.responseText);
                }
            });
        });
    });

    // Helper function to get the CSRF token from the cookie
    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    function playSongs(songs) {
        var currentIndex = 0;
        let title = document.getElementById('title')
        let wave = document.getElementById('wave');
        let poster_master_play = document.getElementById('poster_master_play')
        function playSong(index) {
            var song = songs[index]
            var music = new Audio(song.file)
            title.innerHTML = song.songName
            poster_master_play.src = song.cover
            wave.classList.add('active1');

            let currentStart = document.getElementById('currentStart')
            let currentEnd = document.getElementById('currentEnd')
            let seek = document.getElementById('seek')
            let bar2 = document.getElementById('bar2')
            let dot = document.getElementsByClassName('dot')[0]


            music.addEventListener('timeupdate', () => {
                let music_curr = music.currentTime;
                let music_dur = music.duration;
                // console.log(music_curr); 
                let min1 = Math.floor(music_dur / 60);
                let sec1 = Math.floor(music_dur % 60);
                if (sec1 < 10) {
                    sec1 = `0${sec1}`
                }
                currentEnd.innerText = `${min1}:${sec1}`

                let min2 = Math.floor(music_curr / 60)
                let sec2 = Math.floor(music_curr % 60)
                if (sec2 < 10) {
                    sec2 = `0${sec2}`
                }
                currentStart.innerText = `${min2}:${sec2}`

                let progressBar = parseFloat((music_curr / music_dur) * 100)
                seek.value = progressBar
                let seekbar = seek.value;
                bar2.style.width = `${seekbar}%`;
                dot.style.left = `${seekbar}%`;

            })


            seek.addEventListener('change', () => {
                music.currentTime = seek.value * music.duration / 100;
            })

            let vol_icon = document.getElementById('vol_icon');
            let vol = document.getElementById('vol');
            let vol_bar = document.getElementsByClassName('vol_bar')[0];
            let vol_dot = document.getElementById('vol_dot');

            vol.addEventListener('change', () => {
                if (vol.value == 0) {
                    vol_icon.classList.remove('bi-volume-up-fill')
                    vol_icon.classList.remove('bi-volume-down-fill')
                    vol_icon.classList.add('bi-volume-off-fill')
                }
                if (vol.value > 0) {
                    vol_icon.classList.remove('bi-volume-up-fill')
                    vol_icon.classList.add('bi-volume-down-fill')
                    vol_icon.classList.remove('bi-volume-off-fill')
                }
                if (vol.value > 50) {
                    vol_icon.classList.add('bi-volume-up-fill')
                    vol_icon.classList.remove('bi-volume-down-fill')
                    vol_icon.classList.remove('bi-volume-off-fill')
                }
                let vol_a = vol.value
                vol_bar.style.width = `${vol_a}%`
                vol_dot.style.left = `${vol_a}%`
                music.volume = vol_a / 100
            })

            music.play().then(() => {
                console.log('Playing:', song.songName)
                music.onended = function () {
                    currentIndex++
                    if (currentIndex < songs.length) {
                        playSong(currentIndex)
                    }
                    else {
                        console.log('All Songs Played')
                    }
                }
            }).catch(function (error) {
                console.log('Error Playing song:', error)
            })
        }
        if (songs.length > 0) {
            playSong(currentIndex)
        }
        else {
            console.log('No Songs found.');
        }
    }
    function ram1(songs) {
        var currentIndex = 0;
        let title = document.getElementById('title')
        let wave = document.getElementById('wave');
        let poster_master_play = document.getElementById('poster_master_play')
        function playSongbyram(index) {
            var song = songs[index];
            console.log(song)
            var music = new Audio(song.file);
            console.log(music + 'Aroma music file is here ')
            title.innerHTML = song.songName
            poster_master_play.src = song.cover
            wave.classList.add('active1');

            let currentStart = document.getElementById('currentStart')
            let currentEnd = document.getElementById('currentEnd')
            let seek = document.getElementById('seek')
            let bar2 = document.getElementById('bar2')
            let dot = document.getElementsByClassName('dot')[0]


            music.addEventListener('timeupdate', () => {
                let music_curr = music.currentTime;
                let music_dur = music.duration;
                // console.log(music_curr); 
                let min1 = Math.floor(music_dur / 60);
                let sec1 = Math.floor(music_dur % 60);
                if (sec1 < 10) {
                    sec1 = `0${sec1}`
                }
                currentEnd.innerText = `${min1}:${sec1}`

                let min2 = Math.floor(music_curr / 60)
                let sec2 = Math.floor(music_curr % 60)
                if (sec2 < 10) {
                    sec2 = `0${sec2}`
                }
                currentStart.innerText = `${min2}:${sec2}`

                let progressBar = parseFloat((music_curr / music_dur) * 100)
                seek.value = progressBar
                let seekbar = seek.value;
                bar2.style.width = `${seekbar}%`;
                dot.style.left = `${seekbar}%`;

            })


            seek.addEventListener('change', () => {
                music.currentTime = seek.value * music.duration / 100;
            })

            let vol_icon = document.getElementById('vol_icon');
            let vol = document.getElementById('vol');
            let vol_bar = document.getElementsByClassName('vol_bar')[0];
            let vol_dot = document.getElementById('vol_dot');

            vol.addEventListener('change', () => {
                if (vol.value == 0) {
                    vol_icon.classList.remove('bi-volume-up-fill')
                    vol_icon.classList.remove('bi-volume-down-fill')
                    vol_icon.classList.add('bi-volume-off-fill')
                }
                if (vol.value > 0) {
                    vol_icon.classList.remove('bi-volume-up-fill')
                    vol_icon.classList.add('bi-volume-down-fill')
                    vol_icon.classList.remove('bi-volume-off-fill')
                }
                if (vol.value > 50) {
                    vol_icon.classList.add('bi-volume-up-fill')
                    vol_icon.classList.remove('bi-volume-down-fill')
                    vol_icon.classList.remove('bi-volume-off-fill')
                }
                let vol_a = vol.value
                vol_bar.style.width = `${vol_a}%`
                vol_dot.style.left = `${vol_a}%`
                music.volume = vol_a / 100
            })


            
            music.play().then(() => {
                console.log('Playing:', song.songName);
                music.onended = function () {
                    currentIndex++;
                    if (currentIndex < songs.length) {
                        playSong(currentIndex);
                    } else {
                        console.log('All Songs Played');
                    }
                };
            }).catch(function (error) {
                console.log('Error Playing song:', error);
            });
            
        }

        if (songs.length > 0) {
            playSongbyram(currentIndex);
        } else {
            console.log('No Songs found.');
        }
    }

    // Rest of your WebSocket code remains unchanged...

    const socket = new WebSocket('ws://' + window.location.host + '/ws/take/');

    socket.onopen = (event) => {
        console.log('WebSocket connection established.');
        // Send a test message to the server upon connection.
        setInterval(
            socket.send(JSON.stringify({ type: 'test_message', data: 'This is a test message.' }))
            , 300);
    };

    socket.onmessage = async (event) => {
        try {
            const data = JSON.parse(event.data);
            console.log('Received JSON data from the server:', data['data']);

            const songsData = JSON.parse(data['data']);
            console.log('Parsed song data:', songsData);
            document.getElementById('play1').addEventListener('click', () => {
                ram1(songsData);
            })

        } catch (error) {
            console.error('Error fetching or processing data:', error);
        }
    };

    socket.onclose = (event) => {
        console.log('WebSocket connection closed.');
    };


</script>
{% endblock %}