{%extends 'base1.html'%}
{% load static %}

{%block profile %}
<li class="user">
    <a href="#">
        <span class="image">
            <img src="{% static 'logo.jpg'%}" alt="logo">
        </span>
        <span class="text header-text">Profile</span>
    </a>
</li>
{%endblock%}

{% block gates %}
<li class="">
    <a href="{% url 'custom_logout' %}">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
            class="bi bi-box-arrow-left icon" viewBox="0 0 16 16">
            <path fill-rule="evenodd"
                d="M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0v2z" />
            <path fill-rule="evenodd"
                d="M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z" />
        </svg>
        <span class="text nav-text">Logout</span>
    </a>
</li>
{% endblock %}

{% block upperheader %}
<div class="content">
    <h1>{{main}}</h1>
    <h1>Favourite</h1>
    <p>The right song can make everything better, so turn up the heat this summer.</p>
    <div class="buttons">
        <button>Enjoy -></button>
        <button>Music</button>
        
    </div>


</div>
{% endblock %}

{% block content %}
<div class="popular_song">
        
        <div class="container-fluid ">
            <table class="table mb-5" style="width: 100%; border: none;">
                <thead id="header1">
                    <tr>
                        <th scope="col" style="padding-left:20px;">#</th>
                        <th scope="col">Cover</th>
                        <th scope="col">Songname</th>
                    </tr>
                </thead>
                <tbody>
                    {% for i in songs %}
                    <tr class="songItem">
                        <th scope="row"> <span class="songno"> {{forloop.counter}}</span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-play-fill playListPlay icon" id="{{forloop.counter}}" viewBox="0 0 16 16">
                                <path
                                    d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z" />
                            </svg>
                        </th>
                        <td>
                            <div class="img_play">
                                <img src="{% static 'logo.jpg' %}" alt="">
                            </div>
                        </td>
                        <td>
                            <h5 id="title">Vande Matrm
                                <div class="subtitle">Bankim Chandra sgfgw wewrwe </div>
                            </h5>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
</div>

{% endblock %}

{% block player %}

<div class="player">
    <div class="master_player">
        <div class="wave" id="wave">
            <div class="wave1"></div>
            <div class="wave1"></div>
            <div class="wave1"></div>
        </div>
        <img src="{% static 'logo.jpg' %}" alt="" id="poster_master_play">
        <h5 id="title1">Vande Matrm
            <div class="subtitle1">Bankim Chandra sgfgw wewrwe </div>
        </h5>
        <div class="icons">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                class="bi bi-music-note-beamed icon shuffle" viewBox="0 0 16 16">
                Next
                <path
                    d="M6 13c0 1.105-1.12 2-2.5 2S1 14.105 1 13c0-1.104 1.12-2 2.5-2s2.5.896 2.5 2zm9-2c0 1.105-1.12 2-2.5 2s-2.5-.895-2.5-2 1.12-2 2.5-2 2.5.895 2.5 2z" />
                <path fill-rule="evenodd" d="M14 11V2h1v9h-1zM6 3v10H5V3h1z" />
                <path d="M5 2.905a1 1 0 0 1 .9-.995l8-.8a1 1 0 0 1 1.1.995V3L5 4V2.905z" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                class="bi bi-skip-start-fill icon" id="back" viewBox="0 0 16 16">
                <path
                    d="M4 4a.5.5 0 0 1 1 0v3.248l6.267-3.636c.54-.313 1.232.066 1.232.696v7.384c0 .63-.692 1.01-1.232.697L5 8.753V12a.5.5 0 0 1-1 0V4z" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                class="bi bi-play-fill icon" id="masterPlay" viewBox="0 0 16 16">
                <path
                    d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                class="bi bi-skip-end-fill icon" id="next" viewBox="0 0 16 16">
                <path
                    d="M12.5 4a.5.5 0 0 0-1 0v3.248L5.233 3.612C4.693 3.3 4 3.678 4 4.308v7.384c0 .63.692 1.01 1.233.697L11.5 8.753V12a.5.5 0 0 0 1 0V4z" />
            </svg>
            <a href="" download id="download_music">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                    class="bi bi-cloud-arrow-down-fill icon" viewBox="0 0 16 16">
                    <path
                        d="M8 2a5.53 5.53 0 0 0-3.594 1.342c-.766.66-1.321 1.52-1.464 2.383C1.266 6.095 0 7.555 0 9.318 0 11.366 1.708 13 3.781 13h8.906C14.502 13 16 11.57 16 9.773c0-1.636-1.242-2.969-2.834-3.194C12.923 3.999 10.69 2 8 2zm2.354 6.854-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 1 1 .708-.708L7.5 9.293V5.5a.5.5 0 0 1 1 0v3.793l1.146-1.147a.5.5 0 0 1 .708.708z" />
                </svg>
            </a>
        </div>
        <span id="currentStart">0:00</span>
        <div class="bar">
            <input type="range" id="seek" min="0" max="100">
            <div class="bar2" id="bar2"></div>
            <div class="dot"></div>
        </div>
        <span id="currentEnd">0:30</span>
        <div class="vol">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                class="bi bi-volume-down-fill icon " id="vol_icon" viewBox="0 0 16 16">
                <path
                    d="M9 4a.5.5 0 0 0-.812-.39L5.825 5.5H3.5A.5.5 0 0 0 3 6v4a.5.5 0 0 0 .5.5h2.325l2.363 1.89A.5.5 0 0 0 9 12V4zm3.025 4a4.486 4.486 0 0 1-1.318 3.182L10 10.475A3.489 3.489 0 0 0 11.025 8 3.49 3.49 0 0 0 10 5.525l.707-.707A4.486 4.486 0 0 1 12.025 8z" />
            </svg>
            <input type="range" name="" id="vol" min="0" max="100">
            <div class="vol_bar"></div>
            <div class="dot" id="vol_dot"></div>
        </div>
    </div>
</div>
{% endblock %}


{% block javascript %}
<script>

   

    const songs = JSON.parse('{{ songs_json|escapejs }}');

    firstsong = "{% static '1.mp3'%}"
    const music = new Audio(firstsong);

    Array.from(document.getElementsByClassName('songItem')).forEach((e, i) => {
        e.getElementsByTagName('img')[0].src = songs[i].cover;
        e.getElementsByTagName('h5')[0].innerHTML = songs[i].songName;
    })



    let masterPlay = document.getElementById('masterPlay');
    let wave = document.getElementById('wave');

    masterPlay.addEventListener('click', () => {
        if (music.paused || music.currentTime <= 0) {
            music.play();
            wave.classList.add('active1');
            pathElement.setAttribute('d', 'M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5zm5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5z');

        }
        else {
            music.pause();
            wave.classList.remove('active1');
            masterPlay.classList.add('bi-play-fill')
            masterPlay.classList.remove('bi-pause-fill')
            pathElement.setAttribute('d', 'm11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z')
            makeAllplays1();
        }

    })

    
   
    const makeAllBackground = () => {
        Array.from(document.getElementsByClassName('songItem')).forEach((el) => {
            el.classList.remove('ram');
        })
    }


    const makeAllplays = () => {
        Array.from(document.getElementsByClassName('playListPlay')).forEach((el) => {
            let pathElement1 = el.querySelector('path');
            pathElement.setAttribute('d', 'M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5zm5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5z');
        })
    }
    const makeAllplays1 = () => {
        Array.from(document.getElementsByClassName('playListPlay')).forEach((el) => {
            let pathElement1 = el.querySelector('path');
            pathElement1.setAttribute('d', 'm11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z')            
        })
    }
    let poster_master_play = document.getElementById('poster_master_play')
    let download_music = document.getElementById('download_music')
    let title = document.getElementById('title1')
    let index = 0;
    Array.from(document.getElementsByClassName('playListPlay')).forEach((e) => {
        e.addEventListener('click', (el) => {
            index = el.target.id;
            console.log(index)
            wave.classList.add('active1');
            let songTitle = songs.filter((els) => {
                return els.id == index;
            });

            songTitle.forEach(elss => {
                let { songName } = elss;
                title.innerHTML = songName;

                let { cover } = elss;
                poster_master_play.src = cover;
                // download_music.setAttribute('download', songName)

                let { file } = elss;
                music.src = file;
                // download_music.href = music_src


            })
            music.play()

            
            makeAllBackground()
            Array.from(document.getElementsByClassName('songItem'))[index - 1].classList.add('ram2')
            Array.from(document.getElementsByClassName('playListPlay'))[index-3].querySelector('path').setAttribute('d', 'M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5zm5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5z');
            
           
            makeAllplays();
            el.target.classList.remove('bi-pause-fill')
            el.target.classList.add('bi-play-fill')
        })
    })

    let currentStart = document.getElementById('currentStart')
    let currentEnd = document.getElementById('currentEnd')
    let seek = document.getElementById('seek')
    let bar2 = document.getElementById('bar2')
    let dot = document.getElementsByClassName('dot')[0]


    music.addEventListener('timeupdate', () => {
        let music_curr = music.currentTime;
        let music_dur = music.duration;
        // console.log(music_curr); 
        let min1 = Math.floor(music_dur / 60);
        let sec1 = Math.floor(music_dur % 60);
        if (sec1 < 10) {
            sec1 = `0${sec1}`
        }
        currentEnd.innerText = `${min1}:${sec1}`

        let min2 = Math.floor(music_curr / 60)
        let sec2 = Math.floor(music_curr % 60)
        if (sec2 < 10) {
            sec2 = `0${sec2}`
        }
        currentStart.innerText = `${min2}:${sec2}`

        let progressBar = parseFloat((music_curr / music_dur) * 100)
        seek.value = progressBar
        let seekbar = seek.value;
        bar2.style.width = `${seekbar}%`;
        dot.style.left = `${seekbar}%`;

    })


    seek.addEventListener('change', () => {
        music.currentTime = seek.value * music.duration / 100;
    })

    let vol_icon = document.getElementById('vol_icon');
    let vol = document.getElementById('vol');
    let vol_bar = document.getElementsByClassName('vol_bar')[0];
    let vol_dot = document.getElementById('vol_dot');

    vol.addEventListener('change', () => {
        if (vol.value == 0) {
            vol_icon.classList.remove('bi-volume-up-fill')
            vol_icon.classList.remove('bi-volume-down-fill')
            vol_icon.classList.add('bi-volume-off-fill')
        }
        if (vol.value > 0) {
            vol_icon.classList.remove('bi-volume-up-fill')
            vol_icon.classList.add('bi-volume-down-fill')
            vol_icon.classList.remove('bi-volume-off-fill')
        }
        if (vol.value > 50) {
            vol_icon.classList.add('bi-volume-up-fill')
            vol_icon.classList.remove('bi-volume-down-fill')
            vol_icon.classList.remove('bi-volume-off-fill')
        }
        let vol_a = vol.value
        vol_bar.style.width = `${vol_a}%`
        vol_dot.style.left = `${vol_a}%`
        music.volume = vol_a / 100
    })


    let back = document.getElementById('back')
    let next = document.getElementById('next')
    back.addEventListener('click', () => {
        index -= 1

        if (index < 1) {
            index = Array.from(document.getElementsByClassName('songItem')).length;
        }

        wave.classList.add('active1');
        let songTitle = songs.filter((els) => {
            return els.id == index;
        });

        songTitle.forEach(elss => {
            let { songName } = elss;
            title.innerHTML = songName;

            let { cover } = elss;
            poster_master_play.src = cover;
            // download_music.setAttribute('download', songName)

            let { file } = elss;
            music.src = file;
            // download_music.href = music_src


        })
        music.play()

        
        makeAllBackground()
        
        Array.from(document.getElementsByClassName('songItem'))[index - 1].classList.add('ram2')

        makeAllplays();

    })
    next.addEventListener('click', () => {
        index++

        if (index > Array.from(document.getElementsByClassName('songItem')).length) {
            index = 1
        }
        wave.classList.add('active1');
        let songTitle = songs.filter((els) => {
            return els.id == index;
        });

        songTitle.forEach(elss => {
            let { songName } = elss;
            title.innerHTML = songName;

            let { cover } = elss;
            poster_master_play.src = cover;
            // download_music.setAttribute('download', songName)

            let { file } = elss;
            music.src = file;
            // download_music.href = music_src


        })
        music.play()

        makeAllBackground()
        
        Array.from(document.getElementsByClassName('songItem'))[index - 1].classList.add('ram2')
        makeAllplays();
    })

    music.addEventListener('ended', () => {
        index++;
        wave.classList.add('active1');
        let songTitle = songs.filter((els) => {
            return els.id == index;
        });

        songTitle.forEach(elss => {
            let { songName } = elss;
            title.innerHTML = songName;

            let { cover } = elss;
            poster_master_play.src = cover;
            // download_music.setAttribute('download', songName)

            let { file } = elss;
            music.src = file;
            // download_music.href = music_src


        })
        music.play()

        makeAllBackground()
        Array.from(document.getElementsByClassName('songItem'))[index - 1].classList.add('ram2')
        
        makeAllplays();

    })
</script>
{% endblock %}